<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../laptop_coding_48.png" type="image/png">
    <title>新手速览</title>
    <!-- 引入 Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar {
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            background-color: #f8f9fa;
            color: #000;
            border-right: 1px solid #ddd;
        }

        .custom-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4caf50;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px solid #4caf50; /* 标题下边框 */
        }

        .title-subtext {
            font-size: 1.2rem;
            color: #6c757d; /* Bootstrap 灰色 */
            text-align: center;
        }
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: #f4f4f9;
            color: #333;
        }
        .content {
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        /* 移动端样式（只在屏幕宽度 < 1024 px 时生效 */
        @media screen and (max-width: 1024px) {
            .sidebar, .right-sidebar {
                display: none; /* 隐藏侧边栏 */
            }
            .content {
                margin: 0;
                padding: 10px;
                width: 100%;
            }
        }
        .content h2 {
            width: 100%;
            font-size: 3rem;
            line-height: 1.6;
            color: #4caf50;
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #4caf50;
            display: inline-block;
            padding-bottom: 10px;
            font-weight: bold;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.1);
        }
        pre {
            background: #E3F2FD;
            color: #212121;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: 0.9em;
        }
        .added {
            color: #10e6e2;
            display: inline-block;
            width: 100%;
        }
        code {
            font-family: "Courier New", Courier, monospace;
        }
        .content h3 {
            margin-top: 60px;
            color: #8e44ad;
        }
        .content h4 {
            margin-top: 40px;
            color: #8e44ad;
        }
        .content p {
            font-size: 1.1em;
            margin: 20px 0;
        }
        .highlight-math {
            background-color: #FFCC99;
            padding: 5px;
            border-radius: 5px;
        }
        .highlight-link {
            color: #f39c12;
            font-weight: bold;
        }
        .highlight {
            background-color: #f1c40f;
            font-weight: bold;
        }
        pre {
            background: #E3F2FD;
            color: #212121;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: 0.9em;
        }
        ul {
            list-style: none;
            padding-left: 20px;
            margin: 10px 0;
        }
        .with-bullets {
            list-style: disc;
            padding-left: 10px;
            margin: 10px 0 10px 20px;
        }
        ul li {
            margin: 4px 0;
            color: #34495e;;
        }
        li .title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 6px;
        }
        li p {
            color: #34495e;
            font-size: 16px;
        }
        .right-sidebar {
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            padding: 20px;
            background-color: #f8f9fa;
            border-left: 1px solid #ddd;
        }
        .right-sidebar a {
            color: #343a40;
            text-decoration: none;
        }
        .right-sidebar a:hover {
            text-decoration: underline;
        }
        .right-sidebar .active {
            font-weight: bold;
            color: #007bff;
        }
        #dynamic-sidebar ul {
            list-style-type: none;
            padding-left: 0;
        }
        #dynamic-sidebar ul ul {
            padding-left: 20px;
        }
        a {
            text-decoration: underline;
            text-underline-offset: 4px;
            color: #3498db;
        }
        a:hover {
            color: #2c3e50;
        }
        img {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15), 0 -2px 6px rgba(0, 0, 0, 0.1);;
        }
        .comment {
            color: #6c757d;
            font-size: 0.9em;
            font-style: italic;
            margin: 20px 0;
            border-left: 3px solid #d6d8db;
            padding-left: 10px;
        }
        table {
            width: 50%;
            border-collapse: collapse;
            margin: 20px auto;
            font-family: Arial, sans-serif;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        .positive {
            color: green;
            font-weight: bold;
        }
        .negative {
            color: red;
            font-weight: bold;
        }
        .scroll-container {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .navigation {
            margin-top: 30px;
            background-color: #f0f0f0;
            display: flex;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }
        .navigation a {
            text-decoration: none;
            color: #007bff;
            font-size: 20px;
            padding: 10px 30px;
        }
        .navigation a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
        <!-- 左侧小节列表 -->
        <nav class="col-md-2 sidebar">

        </nav>

        <!-- 中间内容：显示具体某一个小节 -->
        <main class="col-md-8 content">
            <h2 class="custom-title">1.1 新手速览</h2>
            <p class="title-subtext">使用 Keras API 构建手写数字识别模型！</p>
            <p style="color: #a0a0a0;">创建日期: 2022-07-16</p>

            <p>本教程简单使用 <a href="https://keras.io/">Keras</a> 来进行以下几点：</p>
            <ol>
                <li>
                    <p>加载预先构建的数据集；</p>
                </li>
                <li>
                    <p>构建对图像进行分类的神经网络机器学习模型；</p>
                </li>
                <li>
                    <p>训练构建的神经网络；</p>
                </li>
                <li>
                    <p>评估模型的准确性。</p>
                </li>
            </ol>

            <p>学习本教程必须具备 Python 基础知识，可以阅读教程 <a href="#">Python 语言入门</a>，针对机器学习而编写。代码实现在文件 <a href="https://github.com/artinte/machine-learning-series/blob/develop/tensorflow/01_quickstart/1_1_quickstart_begginer.py">quickstart_beginner.py</a> 中，可在本地电脑上安装 Python 环境，下载相关依赖，点击运行！</p>
            <p>以下示例图片由程序 <a href="https://github.com/artinte/machine-learning-series/blob/develop/tensorflow/01_quickstart/1_2_show_mnist_tfds.py">show_mnist_tfds.py</a> 生成：</p>
            <img src="res/show_mnist_tfds.png" alt="MNIST 示例图片" width="400">

            <h3>1.1.1 设置</h3>

            <p>程序中引入 <em>Keras</em> 和 <em>TensorFlow</em> (可选) 库：</p>
            <pre><code>import keras
import tensorflow as tf

print('Keras version:', keras.__version__)
print('TensorFlow version:', tf.__version__)</code></pre>

            <p>输出两者的版本号，因为程序简单，版本差异不影响最终结果：</p>
            <pre><samp>Keras version: 3.6.0
TensorFlow version: 2.18.0</samp></pre>

            <p><a href="https://www.tensorflow.org/">TensorFlow</a> 是一个端到端的机器学习开源平台。<a href="https://keras.io/">Keras</a> 是一个可以使用 TensorFlow 作为后端的深度学习 API ，让开发人员能够简单、灵活地构建模型！</p>

            <h3>1.1.2 加载数据集</h3>

            <p>加载并准备 MNIST 数据集，图像像素值范围为 <em>[0, 255]</em> 。通过将这些值除以 <em>255.0</em> ，缩小到 <em>[0, 1]</em> 的范围，这还会将样本数据从整形转换为浮点型：</p>
            <pre><code>(x_train, y_train), (x_test, y_test) = keras.datasets.mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0</code></pre>

            <h3>1.1.3 构建模型</h3>
            <p>建立 <code>keras.models.Sequential</code> 模型：</p>
            <pre><code>model = keras.models.Sequential([
    keras.layers.Flatten(input_shape=(28, 28)),
    keras.layers.Dense(128, activation='relu'),
    keras.layers.Dropout(0.1),
    keras.layers.Dense(10)
])</code></pre>

            <p><a href="https://www.tensorflow.org/guide/keras/sequential_model">Sequential</a> 用于将 <strong>层 (Layer)</strong> 进行堆叠，其中每一层都有一个输入张量和一个输出张量。层是具有已知数学结构的函数，可以重复使用，并具有可训练的变量。大多数 TensorFlow 模型是由层组成，本模型使用了 <code>Flatten</code> 、<code>Dense</code> 和 <code>Dropout</code> 层。</p>
            <p>对于每个示例，模型都会返回一个 <strong><em>Logits</em> 分数</strong> 向量，向量的长度为类别 (0-9) 的个数（本示例为 10）。</p>
            <pre><code>NUM = 5
predictions = model.call(x_train[:NUM]).numpy()
print(numpy.round(predictions, 3))</code></pre>
            <p>获取 5 个样本，输入到模型中，输出 <em>Logits</em> 分数，保留 3 位小数：</p>
            <pre><samp>[[-0.797  0.542 -0.022 -0.481  0.255 -0.392 -0.245 -0.312  0.504  0.064]
 [-0.379  0.724 -0.208 -0.074  0.267 -0.277 -0.065 -0.521  0.559 -0.346]
 [-0.696  0.233  0.224 -0.351 -0.181 -0.293  0.202 -0.245  0.535 -0.139]
 [-0.348 -0.472 -0.281 -0.101  0.154 -0.258 -0.396 -0.699  0.596 -0.044]
 [-0.544  0.774 -0.79  -0.719  0.233 -0.238 -0.13  -0.153  0.599 -0.2  ]]</samp></pre>

            <p>使用 <code>tf.nn.softmax</code> 函数将这些 <em>Logits</em> 分数转换为每个类别的 <strong>概率 (Probability)</strong> ：</p>
            <pre><code>probabilities = tf.nn.softmax(predictions).numpy()
print(numpy.round(probabilities, 3))</code></pre>

            <pre><samp>[[0.045 0.173 0.098 0.062 0.129 0.068 0.079 0.073 0.166 0.107]
 [0.065 0.196 0.077 0.088 0.124 0.072 0.089 0.056 0.166 0.067]
 [0.05  0.128 0.127 0.071 0.084 0.076 0.124 0.079 0.173 0.088]
 [0.08  0.07  0.085 0.102 0.132 0.087 0.076 0.056 0.205 0.108]
 [0.057 0.214 0.045 0.048 0.125 0.078 0.087 0.085 0.18  0.081]]</samp></pre>

            <p class="comment">注：可以将 <code>tf.nn.softmax</code> 函数嵌入到网络最后一层的激活函数中。虽然这样做可以让模型输入更容易理解，但是不建议采用这种方法，因为在使用 softmax 输出后，不可能为所有模型提供精确且数值稳定的损失计算。</p>

            <p>使用 <code>keras.losses.SparseCategoricalCrossentropy</code> 为训练过程定义损失函数：</p>
            <pre><code>loss_fn = keras.losses.SparseCategoricalCrossentropy(from_logits=True)</code></pre>

            <p>损失函数接收一个真实值向量和一个 <em>Logits</em> 值向量，为每个样本返回一个标量损失。此损失为对应真实类别的 <em>Logits</em> 值的负对数函数值：如果模型确定正确的类别，则损失为零。 </p>
            <p>未经训练的模型给出的概率是随机的（每个类别为 1/10 ），所以初始损失应该接近 \(-ln(1/10) ~= 2.3\)</code> ：</p>
            <pre><code>print(loss_fn(y_train[:NUM], predictions).numpy())</code></pre>
            <pre><samp>2.442869</samp></pre>
            <p>在开始训练之前，需要使用 <code>Model.compile</code> 函数配置并编译模型。将 <code>optimizer</code> 参数设置为 <code>adam</code> ，使用 <code>loss_fn</code> 作为损失函数，并通过 <code>metrics</code> 指定需要评估的指标：</p>
            <pre><code>model.compile(optimizer='adam',
              loss=loss_fn,
              metrics=['accuracy'])</code></pre>
            
            <h3>1.1.4 训练与评估</h3>

            <p>使用 <code>Model.fit</code> 方法调整模型的参数并最小化损失：</p>
            <pre><code>model.fit(x_train, y_train, epochs=5)</code></pre>
            <p>训练过程中模型识别的准确率逐渐提高，最终达到 <em>98.30%</em> ：</p>
            <pre><samp>Epoch 1/5
1875/1875 ━━━━━━━━━━━━━━━━━━━━ 3s 1ms/step - accuracy: 0.8643 - loss: 0.4636.2900
Epoch 2/5
1875/1875 ━━━━━━━━━━━━━━━━━━━━ 3s 1ms/step - accuracy: 0.9584 - loss: 0.1399  
Epoch 3/5
1875/1875 ━━━━━━━━━━━━━━━━━━━━ 3s 1ms/step - accuracy: 0.9719 - loss: 0.0934  
Epoch 4/5
1875/1875 ━━━━━━━━━━━━━━━━━━━━ 3s 2ms/step - accuracy: 0.9795 - loss: 0.0696  
Epoch 5/5
1875/1875 ━━━━━━━━━━━━━━━━━━━━ 3s 1ms/step - accuracy: 0.9830 - loss: 0.0572 </samp></pre>

            <p>使用 <code>Model.evaluate</code> 方法在测试集上评估模型的性能：</p>
            <pre><code>model.evaluate(x_test, y_test, verbose=2)</code></pre>
            <p>模型在从未看过的样本上依然有 <em>97.65%</em> 的正确率（稍微低于训练）： </p>
            <pre><samp>313/313 - 0s - 1ms/step - accuracy: 0.9765 - loss: 0.0735</samp></pre>

            <p>如果我们希望模型返回一个概率，可以包装训练好的模型，将 softmax 层附加在最后：</p>
            <pre><code>probability_model = keras.Sequential([
    model,
    keras.layers.Softmax()
])</code></pre>

            <p>用测试集前 5 张图片进行测试，它们的标签分别是：[7 2 1 0 4] ，可以看到和预测结果是一致的：</p>
            <pre><code>probabilities = probability_model(x_test[:NUM]).numpy()
print(numpy.round(probabilities, 3))
print('Predict label:', probabilities.argmax(axis=-1))
print('True label:', y_test[:NUM])</code></pre>
            <pre><samp>[[0.    0.    0.    0.    0.    0.    0.    1.    0.    0.   ]
 [0.    0.001 0.999 0.    0.    0.    0.    0.    0.    0.   ]
 [0.    0.999 0.    0.    0.    0.    0.    0.001 0.    0.   ]
 [1.    0.    0.    0.    0.    0.    0.    0.    0.    0.   ]
 [0.    0.    0.    0.    0.994 0.    0.    0.001 0.    0.005]]
Predict label: [7 2 1 0 4]
True label: [7 2 1 0 4]</samp></pre>

            <p>恭喜！我们已经使用 Keras 的 API ，利用预先构建的数据集，训练了机器学习模型。</p>

            <div class="navigation">
                <a href="https://www.tensorflow.org/install">上一节：1.0 环境配置</a>
                <a href="quickstart_expert.html">下一节：1.2 专家速览</a>
            </div>
        </main>

            <!-- 右侧小标题导航 -->
            <aside class="col-md-2 right-sidebar">
                <h5><a href="index.html#section1">快速入门</a></h5>
                <ul id="dynamic-sidebar" class="nav flex-column">
                    <!-- 动态内容 -->
                </ul>
            </aside>
        </div>
    </div>

        <!-- 引入 Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>

        <script>
            // 获取所有的 h3 和 h4 元素
            const sidebar = document.getElementById('dynamic-sidebar');
            const elements = Array.from(document.querySelectorAll('h3, h4')); // 获取所有 h3 和 h4 元素

            // 动态生成目录项
            elements.forEach(element => {
                // 如果没有 id，则为该元素生成一个 id
                if (!element.id) {
                    element.id = `${element.tagName.toLowerCase()}-${Math.random().toString(36).substr(2, 9)}`;
                }

                const link = document.createElement('a');
                link.href = `#${element.id}`;
                link.textContent = element.textContent;

                const listItem = document.createElement('li');
                // 如果是 h4 元素，添加缩进
                if (element.tagName.toLowerCase() === 'h4') {
                    listItem.style.marginLeft = '20px'; // 控制缩进
                }
                listItem.appendChild(link);

                sidebar.appendChild(listItem);
            });

            // 高亮当前目录项
            function highlightCurrentLink(targetId) {
                const links = sidebar.querySelectorAll('a');
                links.forEach(link => {
                    if (link.getAttribute('href') === `#${targetId}`) {
                        link.classList.add('highlight-link');
                    } else {
                        link.classList.remove('highlight-link');
                    }
                });
            }

            // 页面滚动时更新高亮
            window.addEventListener('scroll', () => {
                let found = false;
                elements.forEach(el => {
                    const rect = el.getBoundingClientRect();
                    if (rect.top <= window.innerHeight / 2 && rect.bottom >= 0) {
                        if (!found) {
                            highlightCurrentLink(el.id);
                            found = true;
                        }
                    }
                });
            });

            // 为每个目录链接添加点击事件
            const links = sidebar.querySelectorAll('a');
            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                        highlightCurrentLink(targetId);
                    }
                });
            });
        </script>
</body>
</html>
